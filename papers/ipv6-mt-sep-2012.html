<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
}
</style>
<title>Сценарии и вопросы перехода на IPv6</title>
</head>
<body>
<!-- Статья в мобильные коммуникации -->


<h1>Сценарии и вопросы перехода на IPv6</h1>

<p><strong>Не смотря на то, что проблеме исчерпания адресов IPv4 уже более 20 лет, только сейчас мировое сообщество вплотную подошло к необходимости внедрения и перехода на новую версию протокола IP — IPv6. Сегодня переход на IPv6 — это не бизнес-задача, а техническая необходимость, признанная мировым сообществом. Целью данной статьи является предложение альтернативы тому множеству механизмов внедрения, которые известны сегодня.</strong></p>

<p>Протокол IP никогда не был рассчитан, на то, что на его основе будет функционировать глобальная взаимоувязанная сеть. Сегодня сеть постоянно растет и расширяется, все новые и новые типы устройств подключаются к сети: игровые приставки, разнообразные беспроводные устройства, сенсоры и многие другие устройства, требующие идентификации в глобальной сети. Протокол IPv6 увеличил место длину адреса в 4 раза: с 32 до 128 бит, что на сегодняшний день более, чем достаточно для уникальной идентификации каждого устройства глобальной сети.</p>

<p>Проблема исчерпания адресов IPv4 известна начиная с зари становления сети Интернет. Первое исчерпание адресов могло случиться приблизительно в 1993–1995 году, из-за неэффективности применения классовой адресации. В декабре 1990-го года было предложено решение изменить способ распределения адресного пространства с помощи технологии CIDR — бесклассовой маршрутизации на основе использования префиксов. Это решение, наряду с использованием частных IP-адресов и их трансляции с помощью NAT, позволила продлить жизнь IPv4.</p>

<p>3-го февраля 2011 года организация IANA, отвечающая за распределение адресного пространства IP, раздала регистраторам последние блоки адресов. Что касается регионального регистратора RIPE NCC, выдающего IP-адреса российским регистраторам, исчерпание адресов ожидается уже в этом октябре <a href="http://www.potaroo.net/tools/ipv4/">[1]</a>. До момента исчерпания, адреса IPv4 никогда не были платным ресурсом для операторов, но в марте 2011 года был дан старт неизбежным спекуляциям адресами: Microsoft приобрела у Nortel 666624 IP-адреса по цене около 11,25$ за адрес.</p>

<h2>Существующие стратегии внедрения IPv6</h2>

<p>На текущий момент существует огромное количество механизмов, позволяющих обеспечить переход на новую версию протокола IP. Однако, все механизмы можно три основных сценария: развертывание двойного стека протоколов, туннелирование трафика и трансляция адресов.</p>

<p><strong>Развертывание двойного стека</strong> (Dual Stack) подразумевает, как это следует из названия, совместное существование протоколов двух версий: на каждом из узлов сети должен быть развернут полный стек протоколов IPv4 и IPv6, а каналы связи остаются прежними — общими для протоколов разных версий. Однако, при расширении такой сети, она вновь будет требовать дополнительных адресов IPv4, ведь необходимо поддерживать обратную совместимость. Таким образом, это никак не решает проблему дефицита адресации. Другой проблемой является то, что если к сегменту сети, построенному таким образом, будут подключены сегменты разных версий IP (например, сеть будет иметь структуру IPv4-DualStack-IPv6), то такие сегменты не смогут взаимодействовать. То есть, например, «старые» сегменты IPv4 не смогут воспользоваться «новыми» услугами IPv6, и наоборот.</p>

<p><strong>Туннелирование трафика</strong> предназначено для связывания совместимых между собой сетей через несовместимую с ними сеть. Эта задача решается путем инкапсуляции информации одного протокола в поле полезной нагрузки другого протокола на промежутке между двумя совместимыми сетями. С точки зрения перехода на IPv6, туннелирование предполагается использовать для переноса IPv6-трафика без потери информации через IPv4-сеть и наоборот. Туннелирование, равно как и двойной стек протоколов, не позволяет узлам, использующим разные версии протоколов, взаимодействовать между собой. Данный метод не позволяет устройствам IPv6 получить доступ к услугам сетей IPv4 и наоборот.</p>

<p><strong>Трансляция адресов</strong> позволяет обеспечить взаимодействие между конечными пользователями, использующими разные версии протоколов. Методы преобразования адресов основаны на использования трансляторов адресов (NAT), популярных в современных сетях доступа. Более того, идея использования NAT уже вышла за пределы сетей доступа в сторону уровня аггрегации. Появилась концепция Carrier-Grade NAT (CGN, «NAT операторского уровня»), который позволяет преобразовывать адреса для маршрутизации в магистральной сети.</p>

<p>Изначально использование CGN было задумано как решение, позволяющее максимально снизить потребление внешних адресов IPv4 за счет архитектуры NAT444: внутренний IPv4-адрес клиента преобразуется во внутренний IPv4-адрес оператора и только потом во внешний адрес IPv4. Однако существует несколько серьезных проблем, связанных с использованием NAT444. Во-первых, если для адресации между CGN и CPE NAT используются те же блоки частных адресов, что и в сетях пользователей, то это может привести к неправильной маршрутизации пакетов и их потере. И, во-вторых, межсетевые экраны, находящиеся в сетях абонентов, зачастую могут быть настроены на блокировку пакетов, адрес отправителя которых — частный, что не позволяет общаться двум абонентам, находящимися в ведении одного и того же CGN.</p>

<p>Преобразование адресов IPv4 в IPv6, называемое NAT64, обеспечивает взаимодействие между сетями и устройствами IPv4 и IPv6, которые могут находиться на любых участках сети. Данное решение позволяет провайдерам и корпорациям ускорить внедрение IPv6 и, одновременно с этим, избежать исчерпания адресного пространства IPv4. Алгоритм NAT64 предполагает большое количество шагов и требует эксплуатации таблиц соответствия адресов. Процедура поиска соответствия требует определенных процессорных затрат, что негативно сказывается на стоимости оборудования и задержках при передаче трафика реального времени.</p>

<h2>Предложения по переходу на IPv6 «с нуля»</h2>

<p>Целью данной статьи является предложение альтернативы текущим устоявшимся практикам по обеспечению внедрения IPv6. Совершенно уместным здесь является слово «внедрение», так как существующие механизмы в основном ориентированы на развертывание инфраструктуры IPv6 не отказываясь от IPv4: основным механизмом является двойной стек протоколов. Не смотря на кажущуюся отдаленность момента, когда будет невозможно разворачивать публичнно-доступные сети IPv4, такой момент рано или поздно наступит. Предлагаемый механизм является именно механизмом <em>перехода</em>, позволяющим постепенно отказываться от существующей инфраструктуры IPv4.</p>

<p>Основной причиной перехода на IPv6 является решение проблемы с исчерпанием адресов IPv4. Это можно сравнить со сменой телефонной нумерации, например, с 6-значной на 7-значную. Так как цель — расширить адресацию, то почему бы не перейти на IPv6 с сохранением текущих адресов?</p>

<p>На первом шаге будет осуществляться переход на IPv6, новый стек протоколов будет внедряться на всех устройствах. Окончанием данного этапа можно будет считать тот момент, когда вся сеть перейдет на IPv6. Однако, адреса устройств будут получены не из глобального пула IPv6, а будут являться как бы «репликой» адресов IPv4. Адрес IPv4 будет без изменений включен в адресное пространство IPv6 согласно рекомендации RFC6052.</p>

<p>Рекомендуется следующий способ формирования адреса. 128-битный адрес IPv6 условно разбивается на четыре части по 32 бита каждая. Первая часть отдается под префикс, который заполняется в соответствии с принятой конвенцией. Во вторую часть адреса помещается адрес IPv4, который был у устройства в стеке IPv4. Третья и четвертая части заполняются нулями.</p>

<p>Сеть оператора будет переходить на IPv6 посегментно. Внутри сегментов IPv6 могут использоваться протоколы маршрутизации и услуги IPv6 без ограничений. Те устройства, которые будут находиться на границах сегментов, использующих протокол IPv4, и сегментов, использующих протокол IPv6 с адресацией IPv4, должны обеспечивать простое алгоритмическое преобразование адресов. Для данного механизма не требуется использовать громоздкие таблицы соответствия адресов, как это происходит в механизме NAT64. Сохранять состояния также нет необходимости. Ниже показана схема взаимодействия сетей IPv4 и IPv6 на первом этапе.</p>

<p><img src="ipv6-mt-sep-2012-transition-step1.png" alt="Картинка" /></p>

<p>Когда все сети будут использовать протокол IPv6 с адресацией IPv4, можно переходить ко второму этапу. На данном этапе адреса должны быть приведены к каноническому виду. Адреса, описанные выше, могут быть либо заменены на адреса из пула Global Unicast Addresses, либо дополнены идентификаторами интерфейса EUI-64, как это предусматривает адресация IPv6. Во втором случае операторы, имеющие в своем распоряжении префикс размером k бит, могут использовать остальные <code>n = 32 − k</code> бит для создания сетей. В этом случае нет необходимости делить 32-битный адрес IPv4 на сеть и узел — он целиком будет идентифицировать сеть. Узлы будут идентифицироваться 64-битным полем EUI-64 в правой части адреса. Данное обстоятельство явилось причиной использовать именно такой способ выражения адреса IPv4 в адрес IPv6 на первом этапе.</p>

<h2>Предложение по взаимодействию сетями IPv6-only</h2>

<h2>Заключение</h2>

<p>Какие же факторы тормозят внедрение IPv6? Нужно отметить, что IPv4 и IPv6 не имеют обратной совместимости. Чтобы обеспечить данную совместимость, операторы вынуждены внедрять двойную инфраструктуру, которая будет удовлетворять нужды обоих протоколов. Внедрение IPv6 сопряжено с большой инерционностью: операторы не спешат переходить на IPv6,</p>
</body>
</html>